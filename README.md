# 基于SharingSphere-jdbc的分库分表方案
## 背景
订单数据存储在MySQL中，随着用户的增多，订单数量也水涨船高，订单数量超过1亿，使用单表保存数据已经无法满足需求，调研了一番，发现Sharding-jdbc是个不错的选择。

## 目标
- sharding-jdbc分库分表
- 动态数据源
- 分表节点动态刷新
- 数据迁移

## 实现思路
使用sharding-jdbc组件进行分库分表，根据订单系统的特性得知，
订单系统包含的主要且不会轻易变动字段有订单id、下单用户、创建时间。
订单id使用雪花算法生成，具备作为分库分表的条件，但这样做同一用户的数据将分散在不同的库中，
这将极大降低查询的效率。用户id使用uuid，使用用户id进行分库可以起到分流数据的作用，
也可以使同一用的数据保存在同一库中，方便查询。订单创建时间具有顺序属性，可以当做分表字段，
可以根据订单数量的增长速度进行分表范围的调整，月->周->天，并且利于旧数据的归档保存。  
在不停机部署的情况下，实施分库分表方案时，需考虑新老数据的一致性。

## sharding-jdbc分库分表
订单系统包含的主要且不会轻易变动字段有订单id、下单用户、创建时间。
### 分库方案
下单用户使用uuid方式存储，根据用户的uuid进行hash后分库
#### 分库算法
默认算法
### 分表方案
使用订单创建时间作为分表字段，更加符合订单查询操作的业务逻辑
#### 分表算法
标准分表算法(精准分表+范围分表)